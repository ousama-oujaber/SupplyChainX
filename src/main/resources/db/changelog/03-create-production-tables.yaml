databaseChangeLog:
  - changeSet:
      id: 03-create-production-tables
      author: protocol
      changes:
        # Create products table
        - createTable:
            tableName: products
            columns:
              - column:
                  name: id_product
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: production_time
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: unit_price
                  type: DECIMAL(10, 2)
                  constraints:
                    nullable: false

        # Create bill_of_materials table
        - createTable:
            tableName: bill_of_materials
            columns:
              - column:
                  name: id_bom
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_product
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: id_material
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: quantity
                  type: DOUBLE
                  constraints:
                    nullable: false

        # Create production_orders table
        - createTable:
            tableName: production_orders
            columns:
              - column:
                  name: id_production_order
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: id_product
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: quantity
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: order_date
                  type: DATE
                  constraints:
                    nullable: false
              - column:
                  name: expected_completion_date
                  type: DATE
              - column:
                  name: actual_completion_date
                  type: DATE
              - column:
                  name: status
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
              - column:
                  name: is_priority
                  type: BOOLEAN
                  defaultValueBoolean: false

        # Add foreign keys
        - addForeignKeyConstraint:
            baseTableName: bill_of_materials
            baseColumnNames: id_product
            constraintName: fk_bom_product
            referencedTableName: products
            referencedColumnNames: id_product
            onDelete: CASCADE
            onUpdate: CASCADE

        - addForeignKeyConstraint:
            baseTableName: bill_of_materials
            baseColumnNames: id_material
            constraintName: fk_bom_material
            referencedTableName: raw_materials
            referencedColumnNames: id_material
            onDelete: CASCADE
            onUpdate: CASCADE

        - addForeignKeyConstraint:
            baseTableName: production_orders
            baseColumnNames: id_product
            constraintName: fk_production_order_product
            referencedTableName: products
            referencedColumnNames: id_product
            onDelete: CASCADE
            onUpdate: CASCADE

        # Add indexes for performance
        - createIndex:
            indexName: idx_product_name
            tableName: products
            columns:
              - column:
                  name: name

        - createIndex:
            indexName: idx_bom_product
            tableName: bill_of_materials
            columns:
              - column:
                  name: id_product

        - createIndex:
            indexName: idx_bom_material
            tableName: bill_of_materials
            columns:
              - column:
                  name: id_material

        - createIndex:
            indexName: idx_production_order_status
            tableName: production_orders
            columns:
              - column:
                  name: status

        - createIndex:
            indexName: idx_production_order_product
            tableName: production_orders
            columns:
              - column:
                  name: id_product

        - createIndex:
            indexName: idx_production_order_priority
            tableName: production_orders
            columns:
              - column:
                  name: is_priority

  - changeSet:
      id: 03-insert-sample-production-data
      author: protocol
      changes:
        # Insert sample products
        - insert:
            tableName: products
            columns:
              - column:
                  name: name
                  value: "Laptop XPS 15"
              - column:
                  name: description
                  value: "High-performance laptop with 15-inch display"
              - column:
                  name: production_time
                  valueNumeric: 120
              - column:
                  name: unit_price
                  valueNumeric: 1299.99

        - insert:
            tableName: products
            columns:
              - column:
                  name: name
                  value: "Smartphone Pro 12"
              - column:
                  name: description
                  value: "Latest flagship smartphone with advanced features"
              - column:
                  name: production_time
                  valueNumeric: 60
              - column:
                  name: unit_price
                  valueNumeric: 899.99

        - insert:
            tableName: products
            columns:
              - column:
                  name: name
                  value: "Wireless Headphones Elite"
              - column:
                  name: description
                  value: "Premium noise-cancelling wireless headphones"
              - column:
                  name: production_time
                  valueNumeric: 30
              - column:
                  name: unit_price
                  valueNumeric: 349.99

        # Insert sample bill of materials
        # Laptop XPS 15 BOM (assuming product ID 1)
        - insert:
            tableName: bill_of_materials
            columns:
              - column:
                  name: id_product
                  valueNumeric: 1
              - column:
                  name: id_material
                  valueNumeric: 1
              - column:
                  name: quantity
                  valueNumeric: 500.0

        - insert:
            tableName: bill_of_materials
            columns:
              - column:
                  name: id_product
                  valueNumeric: 1
              - column:
                  name: id_material
                  valueNumeric: 2
              - column:
                  name: quantity
                  valueNumeric: 2.0

        # Smartphone Pro 12 BOM (assuming product ID 2)
        - insert:
            tableName: bill_of_materials
            columns:
              - column:
                  name: id_product
                  valueNumeric: 2
              - column:
                  name: id_material
                  valueNumeric: 1
              - column:
                  name: quantity
                  valueNumeric: 200.0

        - insert:
            tableName: bill_of_materials
            columns:
              - column:
                  name: id_product
                  valueNumeric: 2
              - column:
                  name: id_material
                  valueNumeric: 3
              - column:
                  name: quantity
                  valueNumeric: 1.5

        # Wireless Headphones Elite BOM (assuming product ID 3)
        - insert:
            tableName: bill_of_materials
            columns:
              - column:
                  name: id_product
                  valueNumeric: 3
              - column:
                  name: id_material
                  valueNumeric: 1
              - column:
                  name: quantity
                  valueNumeric: 100.0

        # Insert sample production orders
        - insert:
            tableName: production_orders
            columns:
              - column:
                  name: id_product
                  valueNumeric: 1
              - column:
                  name: quantity
                  valueNumeric: 50
              - column:
                  name: order_date
                  value: "2024-01-15"
              - column:
                  name: expected_completion_date
                  value: "2024-01-25"
              - column:
                  name: status
                  value: "EN_PRODUCTION"
              - column:
                  name: is_priority
                  valueBoolean: true

        - insert:
            tableName: production_orders
            columns:
              - column:
                  name: id_product
                  valueNumeric: 2
              - column:
                  name: quantity
                  valueNumeric: 100
              - column:
                  name: order_date
                  value: "2024-01-20"
              - column:
                  name: expected_completion_date
                  value: "2024-01-28"
              - column:
                  name: status
                  value: "EN_ATTENTE"
              - column:
                  name: is_priority
                  valueBoolean: false

        - insert:
            tableName: production_orders
            columns:
              - column:
                  name: id_product
                  valueNumeric: 3
              - column:
                  name: quantity
                  valueNumeric: 200
              - column:
                  name: order_date
                  value: "2024-01-10"
              - column:
                  name: expected_completion_date
                  value: "2024-01-18"
              - column:
                  name: actual_completion_date
                  value: "2024-01-17"
              - column:
                  name: status
                  value: "TERMINE"
              - column:
                  name: is_priority
                  valueBoolean: false
